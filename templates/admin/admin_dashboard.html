<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        
        .lot-card, .user-table, .summary-charts { margin: 10px 0; }
        .slots-grid { display: flex; flex-wrap: wrap; gap: 5px; }
        #addLotModal { z-index: 1000; }
            .slot {
              cursor : pointer ;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        font-weight: bold;
        margin: 3px;
    }
    .modal-backdrop {
  display: none !important;
}

    .occupied {
        background-color: red;
        color: white;
    }
    .available {
        background-color: #d3d3d3e6;
        color: black;
        border: 1px solid #ccc;
    }
    .modal-dialog {
  max-width: 500px;
}

.modal-body {
  max-height: 300px;
  overflow-y: auto;
}

    </style>
</head>
<body>
<div class="dashboard-container">
    <div class="dashboard-header d-flex justify-content-between">
        <div class="welcome font-weight-bold text-success">Welcome to Admin Dashboard</div>
        <div class="nav-links">
            <a href="{{ url_for('admin_dashboard') }}">Home</a> |
            <a href="{{ url_for('view_users') }}">Users</a> |
            <a href="{{ url_for('search_parking_lots') }}">Search</a> |
            <a href="{{ url_for('summary_page') }}">Summary</a> |
            <a href="{{ url_for('admin_login') }}">Logout</a> |
            <a href="#" data-toggle="modal" data-target="#editProfileModal">Edit Profile</a>

        </div>
    </div>

    <!-- Section: Parking Lots -->
    <div id="home" class="section">
        <h2>Parking Lots</h2>
        <div class="lot-container">
            {% for lot in parking_lots %}
            <div class="lot-card border p-3 mb-3">
                <div class="lot-header d-flex justify-content-between align-items-center">
                    <span class="lot-title">Parking #{{ lot.id }} - {{ lot.prime_location_name }}</span>
                    <div>
                        <a href="#" data-toggle="modal" data-target="#editLotModal{{ lot.id }}">Edit</a> |
                        <a href="{{ url_for('delete_lot', lot_id=lot.id) }}" class="text-danger">Delete</a>
                    </div>
                </div>
                <div class="occupancy">Occupied: {{ lot.occupied }}/{{ lot.capacity }}</div>
                <div class="slots-grid">
    {% for slot in lot.slots %}
        <div class="slot {{ 'occupied' if slot.occupied else 'available' }}"
             data-toggle="modal"
             data-target="#slotModal{{ lot.id }}_{{ loop.index }}">
            {{ 'O' if slot.occupied else 'A' }}
        </div>

        <!-- Modal for each slot -->
        <div class="modal fade" id="slotModal{{ lot.id }}_{{ loop.index }}" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Slot Details</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        {% if slot.occupied %}
                            <p><strong>Status:</strong> Occupied</p>
                            <p><strong>Booking ID:</strong> {{ slot.id }}</p>
                            <p><strong>User ID:</strong> {{ slot.user_id }}</p>
                            <p><strong>Vehicle Number:</strong> {{ slot.vehicle_no }}</p>
                            <p><strong>Timestamp:</strong> {{ slot.timestamp }}</p>
                            <p><strong>Estimated Cost:</strong> â‚¹{{ slot.cost }}</p>
                        {% else %}
                            <p><strong>Status:</strong> Available</p>
                            <p><strong>Slot ID:</strong> {{ loop.index }}</p>
                            <form method="POST" action="{{ url_for('delete_available_slot') }}">
                                <input type="hidden" name="lot_id" value="{{ lot.id }}">
                                <input type="hidden" name="slot_index" value="{{ loop.index }}">
                                <button type="submit" class="btn btn-danger">Delete Slot</button>
                            </form>
                        {% endif %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
</div>


            </div>

            <!-- Slot Detail Modal -->
<div class="modal fade" id="slotModal" tabindex="-1" role="dialog" data-backdrop="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Slot Details</h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body" id="slotModalBody">
        <!-- Filled by JS -->
      </div>
      <div class="modal-footer" id="slotModalFooter">
        <!-- Filled by JS -->
      </div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <form method="POST" action="{{ url_for('edit_profile') }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileLabel">Edit Admin Profile</h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">

        <label>Username:</label>
        <input type="text" name="username" value="{{ admin.username }}" class="form-control" required>

        <label>Password:</label>
        <input type="text" name="password" value="{{ admin.password }}" class="form-control" required>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success">Update</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>


            <!-- Edit Lot Modal -->
            <div class="modal fade" id="editLotModal{{ lot.id }}" tabindex="-1" role="dialog" data-backdrop="false" data-keyboard="false">
                <div class="modal-dialog" role="document">
                    <form action="{{ url_for('edit_lot') }}" method="POST" class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Parking Lot #{{ lot.id }}</h5>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="lot_id" value="{{ lot.id }}">
                            <label>Location:</label>
                            <input type="text" name="location" value="{{ lot.prime_location_name }}" required class="form-control">
                            <label>Address:</label>
                            <input type="text" name="address" value="{{ lot.address }}" required class="form-control">
                            <label>Pin Code:</label>
                            <input type="text" name="pin_code" value="{{ lot.pin_code }}" required class="form-control">
                            <label>Price:</label>
                            <input type="number" name="price" value="{{ lot.price }}" required class="form-control">
                            <label>Spots:</label>
                            <input type="number" name="spots" value="{{ lot.capacity }}" required class="form-control">
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Update</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Add Parking Lot Button -->
        <div class="text-center my-4">
            <button class="btn btn-success" data-toggle="modal" data-target="#addLotModal">+ Add Parking Lot</button>
        </div>

        <!-- Add Parking Lot Modal -->
        <div class="modal fade" id="addLotModal" tabindex="-1" role="dialog" data-backdrop="false" data-keyboard="false">
            <div class="modal-dialog" role="document">
                <form method="POST" action="{{ url_for('create_parking_lot') }}" class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Parking Lot</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <label>Location:</label>
                        <input name="location" class="form-control" required>
                        <label>Address:</label>
                        <input name="address" class="form-control" required>
                        <label>Pin Code:</label>
                        <input name="pin_code" class="form-control" required>
                        <label>Price:</label>
                        <input name="price" class="form-control" required>
                        <label>Spots:</label>
                        <input name="spots" class="form-control" required>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Create</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<script>
  $(document).ready(function() {
    $('.slot').on('click', function() {
      const id = $(this).data('id');
      const status = $(this).data('status');
      const userId = $(this).data('userid');
      const vehicle = $(this).data('vehicle');
      const timestamp = $(this).data('timestamp');
      const cost = $(this).data('cost');

      let bodyHtml = '';
      let footerHtml = '';

      if (status === 'O') {
        bodyHtml = `
          <p><strong>Slot ID:</strong> ${id}</p>
          <p><strong>Customer ID:</strong> ${userId}</p>
          <p><strong>Vehicle Number:</strong> ${vehicle}</p>
          <p><strong>Time:</strong> ${timestamp}</p>
          <p><strong>Estimated Cost:</strong> â‚¹${cost}</p>
        `;
        footerHtml = `<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>`;
      } else {
        bodyHtml = `
          <p><strong>Slot ID:</strong> ${id}</p>
          <p><strong>Status:</strong> Available</p>
        `;
        footerHtml = `
          <form method="POST" action="/delete_slot/${id}" style="display:inline;">
            <button type="submit" class="btn btn-danger">Delete Slot</button>
          </form>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        `;
      }

      $('#slotModalBody').html(bodyHtml);
      $('#slotModalFooter').html(footerHtml);
    });
  });
</script>

<script>
  $('#slotModal').on('show.bs.modal', function () {
    $(this).data('bs.modal')._backdrop = null;
  });
</script>


<!-- JS Includes -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
